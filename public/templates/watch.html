<div class="watch">
    <div class='load-spinner' v-if="loading"></div>
    <div v-else>
        <div class="d-flex mb-2 justify-content-between">
            <div>
                <button class="btn btn-outline-secondary btn-sm" @click="back"><i class="fa fa-arrow-left" aria-hidden="true"></i> Назад</button>
            </div>
            <div class="btn-group" data-toggle='buttons' v-if='anime.localFiles'>
                <label class="btn btn-secondary" :class='{active: !local}' @click='localToggle'>
                    <input type="radio" name='watchType' id='online' :cheked='!local'> Онлайн просмотр
                </label>
                <label class="btn btn-secondary" :class='{active: local}' @click='localToggle'>
                    <input type="radio" name='watchType' id='offline' :cheked='local'> Локальные файлы
                </label>
            </div>
        </div>
        <h3 class="mb-2">{{ anime.russian }} [{{ watch.ep }} / {{ anime.episodes_aired || anime.episodes }}]</h3>
        <div class="row">
            <div class="col-lg-8 mb-3">
                <div class="player-contaier embed-responsive embed-responsive-16by9">
                    
                    <video :src="localFile.url" class='embed-responsive-item' v-if='localFile' controls id='localPlayer'>
                        <!-- <track label="Russian" kind="subtitles" srclang="ru" :src="localFile.subs.url" default v-if='localFile.subs'> -->
                    </video>
                    <iframe :src="videoEmbed" frameborder="0" id="player" class='embed-responsive-item' v-else-if="!loadingVideo" allowfullscreen></iframe>
                    <div class='load-spinner center' v-else></div>
                </div>
            </div>

            <!-- Онлайн просмотр -->
            <div class="col-lg-4 video-variants" v-if='!local'>
                <b-card no-body>
                    <b-tabs ref="tabs">
                        <b-tab title="Озвучка"  v-if='videos.fandub && videos.fandub.length' active>
                            <ul class="video-players fandub">
                                <li v-for="video in videos.fandub" v-if="video.author && video.author.length" :class="{active: video.video_id === videos.player.video_id}" @click="change_videoId(video.video_id)" class="d-flex justify-content-between">
                                    <span>{{ video.author || watch.ep + ' серия' }}</span><span class="hosting">{{ video.hosting }}</span>
                                </li>
                            </ul>
                        </b-tab>
                        <b-tab title="Субтитры" v-if='videos.sub && videos.sub.length'>
                            <ul class="video-players sub">
                                <li v-for="video in videos.sub" v-if="video.author && video.author.length" :class="{active: video.video_id === videos.player.video_id, eng: video.kindClass && video.kindClass.indexOf('english') !== -1}" @click="change_videoId(video.video_id)" class="d-flex justify-content-between">
                                    <span>{{ video.author || watch.ep + ' серия' }}</span><span class="hosting">{{ video.hosting }}</span>
                                </li>
                            </ul>
                        </b-tab>
                        <b-tab title="Оригинал" v-if='videos.raw && videos.raw.length'>
                            <ul class="video-players raw">
                                <li v-for="video in videos.raw" v-if="video.author && video.author.length" :class="{active: video.video_id === videos.player.video_id}" @click="change_videoId(video.video_id)" class="d-flex justify-content-between">
                                    <span>{{ video.author || watch.ep + ' серия' }}</span><span class="hosting">{{ video.hosting }}</span>
                                </li>
                            </ul>
                        </b-tab>
                    </b-tabs>
                </b-card>
                <select id="select-ep" class="form-control" v-model="watch.ep">
                    <option v-for="epNum in anime.episodes_aired" :value="epNum" @click="watch.video_id=null">{{epNum}} серия</option>
                </select>
            </div>

            <!-- Локальные файлы в папке -->
            <div class="col-lg-4 video-variants" v-else>
                <b-card no-body>
                    <b-tabs ref='tabs'>
                        <b-tab title='Файлы в папке' active>
                            <ul class="video-players local">
                                <li v-for="file in anime.localFiles" class="d-flex justify-content-between" :class='{active: file == localFile}' @click='localFile = file'>
                                    <span>{{file.name}}</span>
                                </li>
                            </ul>
                        </b-tab>
                    </b-tabs>
                </b-card>
            </div>
        </div>
        <div class="d-flex justify-content-between mt-3">
            <button class="btn btn-outline-warning" :class="{disabled: watch.ep === 1}" @click="prevEp"><i class="fa fa-arrow-left" aria-hidden="true"></i> Предыдущая серия</button>
            <button class="btn" :class="{'btn-outline-info': !anime.watched || watch.ep > anime.watched, 'btn-info': watch.ep <= anime.watched}" @click="markAsWatched"><i class="fa fa-check" aria-hidden="true"></i> Просмотрено</button>
            <button class="btn btn-outline-warning" :class="{disabled: watch.ep === (anime.episodes_aired || anime.episodes)}" @click="nextEp"><i class="fa fa-arrow-right" aria-hidden="true"></i> Следующая серия</button>
        </div>
        <div class="mt-3 mb-3 note" v-if="config.get('anime.showNotes', true)">
            <textarea name="note" id="note" cols="30" rows="3" placeholder="Заметка о серии" class='form-control' v-model.lazy='anime.notes[watch.ep]' @change='note'></textarea>
        </div>
    </div>
</div>